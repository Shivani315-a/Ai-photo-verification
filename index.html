
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Face Analysis</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f4f8;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
  }
  h1 { color: #333; }
  input[type="file"] { display: none; }
  label {
    background-color: #007bff;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    margin-bottom: 20px;
  }
  label:hover { background-color: #0056b3; }
  #preview img {
    max-width: 300px;
    border-radius: 12px;
    margin-top: 20px;
  }
  #result { margin-top: 20px; width: 100%; max-width: 400px; }
  .result-card {
    background: #fff;
    padding: 12px 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .badge {
    padding: 4px 10px;
    border-radius: 6px;
    font-weight: bold;
    color: white;
    font-size: 0.85em;
  }
  .open { background: #28a745; }
  .closed { background: #dc3545; }
  .glasses { background: #007bff; }
  .no-glasses { background: #6c757d; }
  .unknown { background: #ffc107; color: #000; }
  .loader {
    margin: 20px auto;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #007bff;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    display: none;
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }
</style>
</head>
<body>
<h1>ðŸ¤– Photo-Analysis</h1>
<label for="fileInput">ðŸ“¤ Upload Image</label>
<input type="file" id="fileInput" accept="image/*" />
<div id="preview"></div>
<div id="loader" class="loader"></div>
<div id="result"></div>

<script>
const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const resultDiv = document.getElementById("result");
const loader = document.getElementById("loader");

fileInput.addEventListener("change", async () => {
  const file = fileInput.files[0];
  if (!file) return;

  // Reset preview and results for new upload
  preview.innerHTML = "";
  resultDiv.innerHTML = "";

  // Show new preview
  preview.innerHTML = `<img src="${URL.createObjectURL(file)}" />`;
  loader.style.display = "block";

  const formData = new FormData();
  formData.append("file", file);

  try {
    const res = await fetch("/analyze-face/", { method: "POST", body: formData });
    const data = await res.json();
    loader.style.display = "none";

    if (data.error) {
      resultDiv.innerHTML = `<div class="result-card">Error: ${data.error}</div>`;
      return;
    }

    let html = "";

    // Overall Eye Status
    html += `<div class="result-card">Overall Eyes: <span class="badge ${
      data.overall_eye_status === "both_open" ? "open" :
      data.overall_eye_status === "both_closed" ? "closed" : "unknown"
    }">${data.overall_eye_status}</span></div>`;

    // Individual eyes
    data.eyes.forEach(e => {
      if (e.error) {
        html += `<div class="result-card">${e.error}</div>`;
      } else {
        html += `<div class="result-card">${e.side}: <span class="badge ${e.status === "open" ? "open" : "closed"}">${e.status}</span></div>`;
      }
    });

    // Ears
    data.ears.forEach(e => {
      html += `<div class="result-card">${e.side}: <span class="badge ${e.visible ? "open" : "closed"}">${e.visible ? "visible" : "hidden"}</span></div>`;
    });

    // Glasses
    html += `<div class="result-card">Glasses: <span class="badge ${data.glasses.label === "glasses" ? "glasses" : "no-glasses"}">${data.glasses.label}</span></div>`;

    resultDiv.innerHTML = html;

    // Clear file input to allow re-upload
    fileInput.value = "";
  } catch (err) {
    loader.style.display = "none";
    resultDiv.innerHTML = `<div class="result-card">Error: ${err.message}</div>`;
    fileInput.value = "";
  }
});
</script>
</body>
</html>
